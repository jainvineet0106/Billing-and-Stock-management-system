<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panal</title>
    <link rel="icon" href="assets/images/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="assets/CSS/style.css">
</head>
<body>
  <div class="sidebar" id="sidebar">
    <h4 class="text-center mb-4">ðŸ›’ Admin Panel</h4>
    <a href="#" class="" onclick="pywebchannel.open_dashboard()"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
    <a href="#" class="" onclick="pywebchannel.open_billing()" ><i class="bi bi-wallet2 me-2"></i>Billing</a>
    <a href="#" class="" onclick="pywebchannel.open_products()"><i class="bi bi-box-seam me-2"></i>Products</a>
    <a href="#" class="" onclick="pywebchannel.open_customers()"><i class="bi bi-people me-2"></i>Customers</a>
    <a href="#" class="active" onclick="pywebchannel.open_settings()"><i class="bi bi-gear me-2"></i>Settings</a>
    <a href="#" class="nav-link text-danger mt-3" onclick="pywebchannel.logout()"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
  </div>
  <div class="content" id="content_slide">
    <nav class="navbar navbar-expand-lg navbar-light bg-light rounded shadow-sm mb-4">
      <div class="container-fluid">
          <button class="btn btn-outline-secondary" id="toggle-btn">
              <i class="bi bi-list"></i>
          </button>
      <span class="navbar-brand d-flex align-items-center gap-3">
        <h2>Welcome,<span id="usernameDisplay"></span>!</h2>
      </span>
      </div>
    </nav>
    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-3">Admin Settings</h4>
      </div>
      <form id="profiledata">
        <input type="hidden" class="form-control" name="id" id="id" value="" />
        <div class="mb-3">
          <label class="form-label">Company Name<span class="text-danger">*</span></label>
          <input type="text" class="form-control" name="companyname" id="companyname" value="" placeholder="Enter Company Name" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Admin Username<span class="text-danger">*</span></label>
          <input type="text" class="form-control" name="username" id="name" value="" placeholder="Enter Admin Username" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Email Address<span class="text-danger">*</span></label>
          <input type="email" class="form-control" name="email" id="email" value="" placeholder="Enter Email Address" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Mobile<span class="text-danger">*</span></label>
          <input type="text" class="form-control" name="mobile" id="mobile" min="0" max="10" value="" placeholder="Enter Mobile Number" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Location<span class="text-danger">*</span></label>
          <input type="text" class="form-control" name="location" id="address" value="" placeholder="Enter Location" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Terms & Conditions <span class="text-danger">*</span></label>
          <div id="termsContainer">
          </div>
          <button type="button" class="btn btn-sm btn-secondary" onclick="addTerm()">+ Add Term</button>
        </div>
        <div class="mb-3">
          <label class="form-label">Change Password<span class="text-danger">*</span></label>
          <input type="password" name="password" value="" class="form-control" placeholder="Enter New Password" />
        </div>
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </form>
    </div>
  </div>

  <footer class="bg-dark text-white text-center py-4">
    <p class="mb-0">&copy; 2025 Billing and Stock management. All rights reserved. Designed by Vineet Jain.</p>
  </footer>

  <script>
    function addTerm() {
      const container = document.getElementById('termsContainer');
      const input = document.createElement('input');
      input.type = 'text';
      input.name = 'terms[]';
      input.className = 'form-control mb-2';
      input.placeholder = 'Enter a term';
      input.required = true;
      container.appendChild(input);
  }
  </script>

  <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
  <script>
      new QWebChannel(qt.webChannelTransport, function(channel) {
          window.pywebchannel = channel.objects.pywebchannel;
            document.getElementById("profiledata").addEventListener("submit", function(e){
            e.preventDefault();
            let id = this.id.value;
            let companyname = this.companyname.value;
            let username = this.username.value;
            let email = this.email.value;
            let mobile = this.mobile.value;
            let address = this.location.value;
            let terms = Array.from(document.querySelectorAll('input[name="terms[]"]'))
                .map(input => input.value.replace('&', '#'))
                .join('\n');
            let password = this.password.value;
            pywebchannel.updatesetting(
                id, companyname, username, 
                email, mobile,
                address, terms, password 
            );
        });
      });
  </script>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const companyname = urlParams.get('companyname');
    const username = urlParams.get('username');
    const email = urlParams.get('email');
    const mobile = urlParams.get('mobile');
    const address = urlParams.get('address');
    const terms = urlParams.get('terms');
    const id = urlParams.get('id');

    document.getElementById('usernameDisplay').innerText = companyname;


    let form = document.getElementsByClassName("form-control");
    Array.from(form).forEach(element => {
        if (element.name === "id") {
            element.value = id || "";
        }else if (element.name === "companyname") {
            element.value = companyname || "";
        }else if (element.name === "username") {
            element.value = username || "";
        }else if (element.name === "email") {
            element.value = email || "";
        }else if (element.name === "mobile") {
            element.value = mobile || "";
        }else if (element.name === "location") {
            element.value = address || "";
        }
    });

    let termsArray = terms ? terms.split('\n') : [];

    for(let i=0; i < termsArray.length; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'terms[]';
        input.value = termsArray[i].replace('#', '&');
        input.className = 'form-control mb-2';
        input.placeholder = 'Enter a term';
        input.required = true;
        document.getElementById('termsContainer').appendChild(input);
    }
  </script>
</body>
</html>